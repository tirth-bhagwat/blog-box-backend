export const Reader = `
import FungibleToken from 0xFungibleToken
import BlogManager from 0xBlogger // address of the blogger account

pub contract Reader {

    pub var SubscriptionStoragePath: StoragePath
    pub var SubscriptionPublicPath: PublicPath


    pub resource Subscriptions{

        access(contract) let subscribedTo: {Address: Bool};
        access(contract) let subscriber: Address;

        init(_ subscriber: Address){
            self.subscribedTo = {};
            self.subscriber = subscriber;
        }

        access(contract) fun subscribe(address: Address){
            self.subscribedTo[address] = true;
        }

        access(contract) fun unsubscribe(address: Address){
            self.subscribedTo.remove(key: address)
        }

        pub fun getSubscriberId(): Address{
            return self.subscriber;
        }

        pub fun isSubscribed(address: Address): Bool{
            return self.subscribedTo[address] ?? false;
        }

        pub fun getSubscriptions() : [Address]{
            return self.subscribedTo.keys;
        }

    }


    init(){

        self.SubscriptionStoragePath = /storage/SubscrptionsCollection
        self.SubscriptionPublicPath = /public/SubscrptionsCollection

        self.account.save(<-self.createEmptySubscribtion(), to: self.SubscriptionStoragePath)
        self.account.link<&Subscriptions>(self.SubscriptionPublicPath, target :self.SubscriptionStoragePath)
        
    }

    pub fun createEmptySubscribtion() : @Subscriptions{
        return <-create Subscriptions(self.account.address);
    }

    pub fun getSubscriptions(): &Subscriptions{
        return self.account.getCapability<&Subscriptions>(self.SubscriptionPublicPath).borrow() ?? panic("Could not borrow capability from public path")
    }

    pub fun subscribe(bloggerAddr: Address){
        // TODO check if address exists in subscriber list then add

        let blogger = getAccount(bloggerAddr);
        let capa = blogger.getCapability<&BlogManager>(BlogManager.BlogCollectionPublicPath)!.borrow() ?? panic("Could not borrow capability from public path");

        if capa.isSubscribed(address: bloggerAddr) {

            let subscription = self.account.borrow<&Subscriptions>(from: self.SubscriptionStoragePath) ?? panic("Could not borrow capability from storage path");

            subscription.subscribe(address: bloggerAddr);

        }


    }

    access(contract) fun unsubscribe(address: Address){
        let subscription = self.account.borrow<&Subscriptions>(from: self.SubscriptionStoragePath) ?? panic("Could not borrow capability from storage path");

        subscription.unsubscribe(address: address);
    }

}
`;
export const BlogManager = `
import FungibleToken from 0xFungibleToken
import FlowToken from 0xFlowToken

pub contract BlogManager {

    pub let BlogCollectionStoragePath : StoragePath
    pub let BlogCollectionPublicPath : PublicPath
    pub let FlowTokenVaultPath: PublicPath
    pub let SubscriptionsStoragePath: StoragePath
    pub let SubscriptionsPublicPath: PublicPath
    pub var idCount:UInt32
    access(contract) var subscriptionCost: UFix64

    pub enum BlogType: UInt8 {
        pub case PUBLIC
        pub case PRIVATE
    }

    pub resource Subscriptions {

        access(self) let subscribedTo: {Address: Bool};
        access(self) let subscriber: Address;

        init(_ subscriber: Address){
            self.subscribedTo = {};
            self.subscriber = subscriber;
        }

        access(contract) fun subscribe(blogger: Address) {
            self.subscribedTo[blogger] = true;
        }

        access(contract) fun unsubscribe(address: Address){
            self.subscribedTo.remove(key: address)
        }

        pub fun getSubscriberId(): Address{
            return self.subscriber;
        }

        pub fun isSubscribed(address: Address): Bool{
            return self.subscribedTo[address] ?? false;
        }

        pub fun getSubscriptions() : [Address]{
            return self.subscribedTo.keys;
        }

    }

    pub resource Blog {
        priv let id: UInt32
        priv let title: String
        priv let description: String
        priv let body: String
        priv let author: String
        priv let type: BlogType

        init(id:UInt32, title: String, description: String, body: String, author: String, type: BlogType) {
            self.id = id
            self.title = title
            self.description = description
            self.body = body
            self.author = author
            self.type = type
        }

        access(contract) fun isPublic(): Bool {
            return self.type == BlogType.PUBLIC
        }

        access(contract) fun getData(): {String:String} {
            return {
                "id": self.id.toString(),
                "title": self.title,
                "description": self.description,
                "body": self.body,
                "author": self.author,
                "type": self.type == BlogType.PUBLIC ? "PUBLIC" : "PRIVATE"
            }
        }
    }

    pub resource BlogCollection {
        priv let ownedBlogs: @{UInt32: Blog}
        priv var subscribers: {Address: Bool}
        priv let ownerAddr: Address

        init(_ owner: Address) {
            self.ownedBlogs <- {}
            self.subscribers = {}
            self.ownerAddr = owner
        }

        access(contract) fun add(blog:@Blog,id:UInt32){
            self.ownedBlogs[id]<-!blog;
        }

        access(contract) fun getBlog(id:UInt32):{String:String}{
            let blog <- self.ownedBlogs.remove(key: id)

            let data = blog?.getData()

            self.ownedBlogs[id]<-!blog;

            return data!

        }

        pub fun getKeys():[UInt32]{
            return self.ownedBlogs.keys;
        }

        pub fun getSubscribers():{Address: Bool}{
            return self.subscribers;
        }

        pub fun getOwner():Address{
            return self.ownerAddr;
        }

        access(contract) fun addSubscriber(address: Address){
            self.subscribers[address] = true
        }

        access(contract) fun removeSubscriber(address: Address){
            self.subscribers.remove(key: address)
        }

        destroy () {
            destroy self.ownedBlogs
        }

    }

    pub fun createEmptyCollection(): @BlogCollection{
        return <- create BlogCollection(self.account.address)
    }

    pub fun createEmptySubscriptions(_ subscriber: Address): @Subscriptions{
        return <- create Subscriptions(subscriber)
    }

    access(contract) fun addSubscriber(address: Address){
        // get the public capability
        let publicCapability = self.account.getCapability<&BlogCollection>(self.BlogCollectionPublicPath).borrow() ?? panic("Could not borrow capability");

        // borrow the collection
        publicCapability.addSubscriber(address: address)
    }

    access(contract) fun removeSubscriber(address: Address){ 
        // get the public capability
        let publicCapability: &BlogManager.BlogCollection = self.account.getCapability<&BlogCollection>(self.BlogCollectionPublicPath).borrow() ?? panic("Could not borrow capability");

        // borrow the collection
        publicCapability.removeSubscriber(address: address)
    }

    access(contract) fun verifySign( address: Address, message: String, signature: String, keyIndex: Int ): Bool 
    {

        let account = getAccount(address)
        let publicKeys = account.keys.get(keyIndex: 1) ?? panic("No key with that index in account")
        let publicKey = publicKeys.publicKey

        let sign = signature.decodeHex()
        let msg = message.utf8

        //     signature: signature,
        // signedData: message,
        // domainSeparationTag: "",
        // hashAlgorithm: HashAlgorithm.SHA2_256

        publicKey.verify(
            signature: sign,
            signedData: msg,
            domainSeparationTag: "",
            hashAlgorithm: HashAlgorithm.SHA2_256
        )

        return  true

    }

    pub fun createBlog(title: String, description: String, body: String, author: String, type: BlogType, blogCollection: &BlogCollection) {

        if blogCollection.getOwner() != self.account.address {
            panic("You are not the owner of this collection")
        }

        self.idCount = self.idCount + 1
        let newBlog: @BlogManager.Blog <- create Blog(id:self.idCount,title:title,description:description,body:body,author:author,type:type);

        let collection: &BlogManager.BlogCollection? = self.account.borrow<&BlogCollection>(from: self.BlogCollectionStoragePath);
        
        collection!.add(blog:<-newBlog,id:self.idCount);
    }

    pub fun getBlog(id:UInt32, address: Address, message: String, signature: String, keyIndex: Int): {String:String}? {

        if !self.isSubscribed(address: address) {
            return nil;
        }

        if !self.verifySign(address: address, message: message, signature: signature, keyIndex: keyIndex) {
            return nil;
        }

        let collection = self.account.borrow<&BlogCollection>(from: self.BlogCollectionStoragePath) ?? panic("Could not borrow capability");
        let blog = collection.getBlog(id:id);

        if blog == nil {
            panic("Blog not found")
        }


        return blog;

    }

    pub fun getAllBlogs(address: Address, message: String, signature: String, keyIndex: Int): [{String:String}]? {
        let collection = self.account.borrow<&BlogCollection>(from: self.BlogCollectionStoragePath) ?? panic("Could not borrow capability");

        if !self.isSubscribed(address: address) {
            return nil;
        }

        if !self.verifySign(address: address, message: message, signature: signature, keyIndex: keyIndex) {
            return nil;
        }

        let keys = collection.getKeys();

        var blogs: [{String:String}] = [];

        for key in keys {
            let blog = collection.getBlog(id:key);
            blogs.append(blog)
        }

        return blogs;
    }

    pub fun getBlogMetadata():[{String:String}]{
        let collection = self.account.borrow<&BlogCollection>(from: self.BlogCollectionStoragePath) ?? panic("Could not borrow capability");

        let keys = collection.getKeys();

        var blogs: [{String:String}] = [];

        for key in keys {
            let blog = collection.getBlog(id:key);
            if (blog["type"] != "PUBLIC") {
                blog.remove(key: "body")
            }
            blogs.append(blog)
        }

        return blogs;
    }

    pub fun subscribe(_ address: Address, vault: @FungibleToken.Vault, subscriptions: &Subscriptions) : Bool {
        if vault.balance != self.subscriptionCost {
            panic("Incorrect amount sent")
        }

        // if address is already subscribed
        if self.isSubscribed(address: address) {
            panic("Already subscribed")
        }

        let depositCapability = self.account.getCapability<&{FungibleToken.Receiver}>(self.FlowTokenVaultPath).borrow() ?? panic("Could not borrow capability")

        depositCapability.deposit(from: <- vault)

        self.addSubscriber(address: address)
        subscriptions.subscribe(blogger: address);

        return true
        
    }

    pub fun unsubscribe(readerAddr: Address, subscriptions: &Subscriptions) : Bool {
        if !self.isSubscribed(address: readerAddr) || subscriptions.getSubscriberId() != readerAddr {
            panic("Not subscribed")
        }

        self.removeSubscriber(address: readerAddr)

        return true
    }

    pub fun getSubscribers():{Address: Bool}{
        let collection = self.account.borrow<&BlogCollection>(from: self.BlogCollectionStoragePath);
        return collection!.getSubscribers();
    }

    pub fun isSubscribed(address: Address): Bool{
        let collection = self.account.borrow<&BlogCollection>(from: self.BlogCollectionStoragePath) ?? panic("Could not borrow capability");
        return collection.getSubscribers()[address] ?? false
    }

    init() {
        self.BlogCollectionStoragePath = /storage/BlogCollection
        self.BlogCollectionPublicPath = /public/BlogCollection

        self.SubscriptionsStoragePath = /storage/Subscriptions
        self.SubscriptionsPublicPath = /public/Subscriptions

        self.FlowTokenVaultPath = /public/flowTokenReceiver

        self.idCount = 0
        self.subscriptionCost = 22.0
 
        self.account.save(<-self.createEmptyCollection(), to: self.BlogCollectionStoragePath)
        self.account.link<&BlogCollection>(self.BlogCollectionPublicPath, target :self.BlogCollectionStoragePath)

        self.account.save(<-self.createEmptySubscriptions(self.account.address), to: self.SubscriptionsStoragePath)
        self.account.link<&Subscriptions>(self.SubscriptionsPublicPath, target :self.SubscriptionsStoragePath)

	}
}

`;
export const TransferFlow = `

import FungibleToken from 0xFungibleToken
import FlowToken from 0xFlowToken

transaction(amount: UFix64, to: Address) {

    // The Vault resource that holds the tokens that are being transferred
    let sentVault: @FungibleToken.Vault

    prepare(signer: AuthAccount) {

        // Get a reference to the signer's stored vault
        let vaultRef = signer.borrow<&FlowToken.Vault>(from: /storage/flowTokenVault)
			?? panic("Could not borrow reference to the owner's Vault!")

        // Withdraw tokens from the signer's stored vault
        self.sentVault <- vaultRef.withdraw(amount: amount)
    }

    execute {
        // Get a reference to the recipient's Receiver
        let receiverRef =  getAccount(to)
            .getCapability(/public/flowTokenReceiver)
            .borrow<&{FungibleToken.Receiver}>()
			?? panic("Could not borrow receiver reference to the recipient's Vault")

        // Deposit the withdrawn tokens in the recipient's receiver
        receiverRef.deposit(from: <-self.sentVault)
    }
}
`;
export const CreateBlog = `
import BlogManager from 0xBlogger

transaction{
    let signerAddr: Address
    prepare(signer: AuthAccount ){

        self.signerAddr = signer.address
        
    }
    execute{

        let signer = getAccount(self.signerAddr)
        if signer.getCapability<&BlogManager.BlogCollection>(BlogManager.BlogCollectionPublicPath).borrow() == nil {
            panic("Signer is not a Blogger")
        }

        let blogCollectionRef = signer.getCapability<&BlogManager.BlogCollection>(BlogManager.BlogCollectionPublicPath).borrow() ?? panic("Signer is not a Blogger")

        BlogManager.createBlog(title:"First Blog",description:"First Blog",body:"First Blog",author:"XYZ",type:BlogManager.BlogType.PUBLIC, blogCollection: blogCollectionRef)

        BlogManager.createBlog(title:"Second Blog",description:"Second Blog",body:"Second Blog",author:"XYZ",type:BlogManager.BlogType.PUBLIC, blogCollection: blogCollectionRef)

        BlogManager.createBlog(title:"Third Blog",description:"Third Blog",body:"Third Blog",author:"XYZ",type:BlogManager.BlogType.PRIVATE, blogCollection: blogCollectionRef)

        BlogManager.createBlog(title:"Fourth Blog",description:"Fourth Blog",body:"Fourth Blog",author:"XYZ",type:BlogManager.BlogType.PRIVATE, blogCollection: blogCollectionRef)

    }
}
`;
export const DeployContract = `
import FungibleToken from 0xFungibleToken
import FlowToken from 0xFlowToken

transaction {
    prepare(acct: AuthAccount) {
        let signer = acct
        // get the list of existing contracts
        var existingContracts = signer.contracts.names
        let BlogManager = "696d706f72742046756e6769626c65546f6b656e2066726f6d203078396130373636643933623636303862370a696d706f727420466c6f77546f6b656e2066726f6d203078376536306466303432613963303836380a0a70756220636f6e747261637420426c6f674d616e61676572207b0a0a20202020707562206c657420426c6f67436f6c6c656374696f6e53746f7261676550617468203a2053746f72616765506174680a20202020707562206c657420426c6f67436f6c6c656374696f6e5075626c696350617468203a205075626c6963506174680a20202020707562206c657420466c6f77546f6b656e5661756c74506174683a205075626c6963506174680a20202020707562206c657420537562736372697074696f6e7353746f72616765506174683a2053746f72616765506174680a20202020707562206c657420537562736372697074696f6e735075626c6963506174683a205075626c6963506174680a2020202070756220766172206964436f756e743a55496e7433320a2020202061636365737328636f6e7472616374292076617220737562736372697074696f6e436f73743a205546697836340a0a2020202070756220656e756d20426c6f67547970653a2055496e7438207b0a20202020202020207075622063617365205055424c49430a2020202020202020707562206361736520505249564154450a202020207d0a0a20202020707562207265736f7572636520537562736372697074696f6e73207b0a0a20202020202020206163636573732873656c6629206c65742073756273637269626564546f3a207b416464726573733a20426f6f6c7d3b0a20202020202020206163636573732873656c6629206c657420737562736372696265723a20416464726573733b0a0a2020202020202020696e6974285f20737562736372696265723a2041646472657373297b0a20202020202020202020202073656c662e73756273637269626564546f203d207b7d3b0a20202020202020202020202073656c662e73756273637269626572203d20737562736372696265723b0a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e2073756273637269626528626c6f676765723a204164647265737329207b0a20202020202020202020202073656c662e73756273637269626564546f5b626c6f676765725d203d20747275653b0a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e20756e73756273637269626528616464726573733a2041646472657373297b0a20202020202020202020202073656c662e73756273637269626564546f2e72656d6f7665286b65793a2061646472657373290a20202020202020207d0a0a20202020202020207075622066756e2067657453756273637269626572496428293a20416464726573737b0a20202020202020202020202072657475726e2073656c662e737562736372696265723b0a20202020202020207d0a0a20202020202020207075622066756e2069735375627363726962656428616464726573733a2041646472657373293a20426f6f6c7b0a20202020202020202020202072657475726e2073656c662e73756273637269626564546f5b616464726573735d203f3f2066616c73653b0a20202020202020207d0a0a20202020202020207075622066756e20676574537562736372697074696f6e732829203a205b416464726573735d7b0a20202020202020202020202072657475726e2073656c662e73756273637269626564546f2e6b6579733b0a20202020202020207d0a0a202020207d0a0a20202020707562207265736f7572636520426c6f67207b0a202020202020202070726976206c65742069643a2055496e7433320a202020202020202070726976206c6574207469746c653a20537472696e670a202020202020202070726976206c6574206465736372697074696f6e3a20537472696e670a202020202020202070726976206c657420626f64793a20537472696e670a202020202020202070726976206c657420617574686f723a20537472696e670a202020202020202070726976206c657420747970653a20426c6f67547970650a0a2020202020202020696e69742869643a55496e7433322c207469746c653a20537472696e672c206465736372697074696f6e3a20537472696e672c20626f64793a20537472696e672c20617574686f723a20537472696e672c20747970653a20426c6f675479706529207b0a20202020202020202020202073656c662e6964203d2069640a20202020202020202020202073656c662e7469746c65203d207469746c650a20202020202020202020202073656c662e6465736372697074696f6e203d206465736372697074696f6e0a20202020202020202020202073656c662e626f6479203d20626f64790a20202020202020202020202073656c662e617574686f72203d20617574686f720a20202020202020202020202073656c662e74797065203d20747970650a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e2069735075626c696328293a20426f6f6c207b0a20202020202020202020202072657475726e2073656c662e74797065203d3d20426c6f67547970652e5055424c49430a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e206765744461746128293a207b537472696e673a537472696e677d207b0a20202020202020202020202072657475726e207b0a20202020202020202020202020202020226964223a2073656c662e69642e746f537472696e6728292c0a20202020202020202020202020202020227469746c65223a2073656c662e7469746c652c0a20202020202020202020202020202020226465736372697074696f6e223a2073656c662e6465736372697074696f6e2c0a2020202020202020202020202020202022626f6479223a2073656c662e626f64792c0a2020202020202020202020202020202022617574686f72223a2073656c662e617574686f722c0a202020202020202020202020202020202274797065223a2073656c662e74797065203d3d20426c6f67547970652e5055424c4943203f20225055424c494322203a202250524956415445220a2020202020202020202020207d0a20202020202020207d0a202020207d0a0a20202020707562207265736f7572636520426c6f67436f6c6c656374696f6e207b0a202020202020202070726976206c6574206f776e6564426c6f67733a20407b55496e7433323a20426c6f677d0a202020202020202070726976207661722073756273637269626572733a207b416464726573733a20426f6f6c7d0a202020202020202070726976206c6574206f776e6572416464723a20416464726573730a0a2020202020202020696e6974285f206f776e65723a204164647265737329207b0a20202020202020202020202073656c662e6f776e6564426c6f6773203c2d207b7d0a20202020202020202020202073656c662e7375627363726962657273203d207b7d0a20202020202020202020202073656c662e6f776e657241646472203d206f776e65720a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e2061646428626c6f673a40426c6f672c69643a55496e743332297b0a20202020202020202020202073656c662e6f776e6564426c6f67735b69645d3c2d21626c6f673b0a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e20676574426c6f672869643a55496e743332293a7b537472696e673a537472696e677d7b0a2020202020202020202020206c657420626c6f67203c2d2073656c662e6f776e6564426c6f67732e72656d6f7665286b65793a206964290a0a2020202020202020202020206c65742064617461203d20626c6f673f2e6765744461746128290a0a20202020202020202020202073656c662e6f776e6564426c6f67735b69645d3c2d21626c6f673b0a0a20202020202020202020202072657475726e2064617461210a0a20202020202020207d0a0a20202020202020207075622066756e206765744b65797328293a5b55496e7433325d7b0a20202020202020202020202072657475726e2073656c662e6f776e6564426c6f67732e6b6579733b0a20202020202020207d0a0a20202020202020207075622066756e20676574537562736372696265727328293a7b416464726573733a20426f6f6c7d7b0a20202020202020202020202072657475726e2073656c662e73756273637269626572733b0a20202020202020207d0a0a20202020202020207075622066756e206765744f776e657228293a416464726573737b0a20202020202020202020202072657475726e2073656c662e6f776e6572416464723b0a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e206164645375627363726962657228616464726573733a2041646472657373297b0a20202020202020202020202073656c662e73756273637269626572735b616464726573735d203d20747275650a20202020202020207d0a0a202020202020202061636365737328636f6e7472616374292066756e2072656d6f76655375627363726962657228616464726573733a2041646472657373297b0a20202020202020202020202073656c662e73756273637269626572732e72656d6f7665286b65793a2061646472657373290a20202020202020207d0a0a202020202020202064657374726f79202829207b0a20202020202020202020202064657374726f792073656c662e6f776e6564426c6f67730a20202020202020207d0a0a202020207d0a0a202020207075622066756e20637265617465456d707479436f6c6c656374696f6e28293a2040426c6f67436f6c6c656374696f6e7b0a202020202020202072657475726e203c2d2063726561746520426c6f67436f6c6c656374696f6e2873656c662e6163636f756e742e61646472657373290a202020207d0a0a202020207075622066756e20637265617465456d707479537562736372697074696f6e73285f20737562736372696265723a2041646472657373293a2040537562736372697074696f6e737b0a202020202020202072657475726e203c2d2063726561746520537562736372697074696f6e732873756273637269626572290a202020207d0a0a2020202061636365737328636f6e7472616374292066756e206164645375627363726962657228616464726573733a2041646472657373297b0a20202020202020202f2f2067657420746865207075626c6963206361706162696c6974790a20202020202020206c6574207075626c69634361706162696c697479203d2073656c662e6163636f756e742e6765744361706162696c6974793c26426c6f67436f6c6c656374696f6e3e2873656c662e426c6f67436f6c6c656374696f6e5075626c696350617468292e626f72726f772829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922293b0a0a20202020202020202f2f20626f72726f772074686520636f6c6c656374696f6e0a20202020202020207075626c69634361706162696c6974792e6164645375627363726962657228616464726573733a2061646472657373290a202020207d0a0a2020202061636365737328636f6e7472616374292066756e2072656d6f76655375627363726962657228616464726573733a2041646472657373297b200a20202020202020202f2f2067657420746865207075626c6963206361706162696c6974790a20202020202020206c6574207075626c69634361706162696c6974793a2026426c6f674d616e616765722e426c6f67436f6c6c656374696f6e203d2073656c662e6163636f756e742e6765744361706162696c6974793c26426c6f67436f6c6c656374696f6e3e2873656c662e426c6f67436f6c6c656374696f6e5075626c696350617468292e626f72726f772829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922293b0a0a20202020202020202f2f20626f72726f772074686520636f6c6c656374696f6e0a20202020202020207075626c69634361706162696c6974792e72656d6f76655375627363726962657228616464726573733a2061646472657373290a202020207d0a0a2020202061636365737328636f6e7472616374292066756e207665726966795369676e2820616464726573733a20416464726573732c206d6573736167653a20537472696e672c207369676e61747572653a20537472696e672c206b6579496e6465783a20496e7420293a20426f6f6c200a202020207b0a0a20202020202020206c6574206163636f756e74203d206765744163636f756e742861646472657373290a20202020202020206c6574207075626c69634b657973203d206163636f756e742e6b6579732e676574286b6579496e6465783a203129203f3f2070616e696328224e6f206b65792077697468207468617420696e64657820696e206163636f756e7422290a20202020202020206c6574207075626c69634b6579203d207075626c69634b6579732e7075626c69634b65790a0a20202020202020206c6574207369676e203d207369676e61747572652e6465636f646548657828290a20202020202020206c6574206d7367203d206d6573736167652e757466380a0a20202020202020202f2f20202020207369676e61747572653a207369676e61747572652c0a20202020202020202f2f207369676e6564446174613a206d6573736167652c0a20202020202020202f2f20646f6d61696e53657061726174696f6e5461673a2022222c0a20202020202020202f2f2068617368416c676f726974686d3a2048617368416c676f726974686d2e534841325f3235360a0a20202020202020207075626c69634b65792e766572696679280a2020202020202020202020207369676e61747572653a207369676e2c0a2020202020202020202020207369676e6564446174613a206d73672c0a202020202020202020202020646f6d61696e53657061726174696f6e5461673a2022222c0a20202020202020202020202068617368416c676f726974686d3a2048617368416c676f726974686d2e534841325f3235360a2020202020202020290a0a202020202020202072657475726e2020747275650a0a202020207d0a0a202020207075622066756e20637265617465426c6f67287469746c653a20537472696e672c206465736372697074696f6e3a20537472696e672c20626f64793a20537472696e672c20617574686f723a20537472696e672c20747970653a20426c6f67547970652c20626c6f67436f6c6c656374696f6e3a2026426c6f67436f6c6c656374696f6e29207b0a0a2020202020202020696620626c6f67436f6c6c656374696f6e2e6765744f776e6572282920213d2073656c662e6163636f756e742e61646472657373207b0a20202020202020202020202070616e69632822596f7520617265206e6f7420746865206f776e6572206f66207468697320636f6c6c656374696f6e22290a20202020202020207d0a0a202020202020202073656c662e6964436f756e74203d2073656c662e6964436f756e74202b20310a20202020202020206c6574206e6577426c6f673a2040426c6f674d616e616765722e426c6f67203c2d2063726561746520426c6f672869643a73656c662e6964436f756e742c7469746c653a7469746c652c6465736372697074696f6e3a6465736372697074696f6e2c626f64793a626f64792c617574686f723a617574686f722c747970653a74797065293b0a0a20202020202020206c657420636f6c6c656374696f6e3a2026426c6f674d616e616765722e426c6f67436f6c6c656374696f6e3f203d2073656c662e6163636f756e742e626f72726f773c26426c6f67436f6c6c656374696f6e3e2866726f6d3a2073656c662e426c6f67436f6c6c656374696f6e53746f7261676550617468293b0a20202020202020200a2020202020202020636f6c6c656374696f6e212e61646428626c6f673a3c2d6e6577426c6f672c69643a73656c662e6964436f756e74293b0a202020207d0a0a202020207075622066756e20676574426c6f672869643a55496e7433322c20616464726573733a20416464726573732c206d6573736167653a20537472696e672c207369676e61747572653a20537472696e672c206b6579496e6465783a20496e74293a207b537472696e673a537472696e677d3f207b0a0a20202020202020206966202173656c662e69735375627363726962656428616464726573733a206164647265737329207b0a20202020202020202020202072657475726e206e696c3b0a20202020202020207d0a0a20202020202020206966202173656c662e7665726966795369676e28616464726573733a20616464726573732c206d6573736167653a206d6573736167652c207369676e61747572653a207369676e61747572652c206b6579496e6465783a206b6579496e64657829207b0a20202020202020202020202072657475726e206e696c3b0a20202020202020207d0a0a20202020202020206c657420636f6c6c656374696f6e203d2073656c662e6163636f756e742e626f72726f773c26426c6f67436f6c6c656374696f6e3e2866726f6d3a2073656c662e426c6f67436f6c6c656374696f6e53746f726167655061746829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922293b0a20202020202020206c657420626c6f67203d20636f6c6c656374696f6e2e676574426c6f672869643a6964293b0a0a2020202020202020696620626c6f67203d3d206e696c207b0a20202020202020202020202070616e69632822426c6f67206e6f7420666f756e6422290a20202020202020207d0a0a0a202020202020202072657475726e20626c6f673b0a0a202020207d0a0a202020207075622066756e20676574416c6c426c6f677328616464726573733a20416464726573732c206d6573736167653a20537472696e672c207369676e61747572653a20537472696e672c206b6579496e6465783a20496e74293a205b7b537472696e673a537472696e677d5d3f207b0a20202020202020206c657420636f6c6c656374696f6e203d2073656c662e6163636f756e742e626f72726f773c26426c6f67436f6c6c656374696f6e3e2866726f6d3a2073656c662e426c6f67436f6c6c656374696f6e53746f726167655061746829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922293b0a0a20202020202020206966202173656c662e69735375627363726962656428616464726573733a206164647265737329207b0a20202020202020202020202072657475726e206e696c3b0a20202020202020207d0a0a20202020202020206966202173656c662e7665726966795369676e28616464726573733a20616464726573732c206d6573736167653a206d6573736167652c207369676e61747572653a207369676e61747572652c206b6579496e6465783a206b6579496e64657829207b0a20202020202020202020202072657475726e206e696c3b0a20202020202020207d0a0a20202020202020206c6574206b657973203d20636f6c6c656374696f6e2e6765744b65797328293b0a0a202020202020202076617220626c6f67733a205b7b537472696e673a537472696e677d5d203d205b5d3b0a0a2020202020202020666f72206b657920696e206b657973207b0a2020202020202020202020206c657420626c6f67203d20636f6c6c656374696f6e2e676574426c6f672869643a6b6579293b0a202020202020202020202020626c6f67732e617070656e6428626c6f67290a20202020202020207d0a0a202020202020202072657475726e20626c6f67733b0a202020207d0a0a202020207075622066756e20676574426c6f674d6574616461746128293a5b7b537472696e673a537472696e677d5d7b0a20202020202020206c657420636f6c6c656374696f6e203d2073656c662e6163636f756e742e626f72726f773c26426c6f67436f6c6c656374696f6e3e2866726f6d3a2073656c662e426c6f67436f6c6c656374696f6e53746f726167655061746829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922293b0a0a20202020202020206c6574206b657973203d20636f6c6c656374696f6e2e6765744b65797328293b0a0a202020202020202076617220626c6f67733a205b7b537472696e673a537472696e677d5d203d205b5d3b0a0a2020202020202020666f72206b657920696e206b657973207b0a2020202020202020202020206c657420626c6f67203d20636f6c6c656374696f6e2e676574426c6f672869643a6b6579293b0a20202020202020202020202069662028626c6f675b2274797065225d20213d20225055424c49432229207b0a20202020202020202020202020202020626c6f672e72656d6f7665286b65793a2022626f647922290a2020202020202020202020207d0a202020202020202020202020626c6f67732e617070656e6428626c6f67290a20202020202020207d0a0a202020202020202072657475726e20626c6f67733b0a202020207d0a0a202020207075622066756e20737562736372696265285f20616464726573733a20416464726573732c207661756c743a204046756e6769626c65546f6b656e2e5661756c742c20737562736372697074696f6e733a2026537562736372697074696f6e7329203a20426f6f6c207b0a20202020202020206966207661756c742e62616c616e636520213d2073656c662e737562736372697074696f6e436f7374207b0a20202020202020202020202070616e69632822496e636f727265637420616d6f756e742073656e7422290a20202020202020207d0a0a20202020202020202f2f206966206164647265737320697320616c726561647920737562736372696265640a202020202020202069662073656c662e69735375627363726962656428616464726573733a206164647265737329207b0a20202020202020202020202070616e69632822416c7265616479207375627363726962656422290a20202020202020207d0a0a20202020202020206c6574206465706f7369744361706162696c697479203d2073656c662e6163636f756e742e6765744361706162696c6974793c267b46756e6769626c65546f6b656e2e52656365697665727d3e2873656c662e466c6f77546f6b656e5661756c7450617468292e626f72726f772829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922290a0a20202020202020206465706f7369744361706162696c6974792e6465706f7369742866726f6d3a203c2d207661756c74290a0a202020202020202073656c662e6164645375627363726962657228616464726573733a2061646472657373290a2020202020202020737562736372697074696f6e732e73756273637269626528626c6f676765723a2061646472657373293b0a0a202020202020202072657475726e20747275650a20202020202020200a202020207d0a0a202020207075622066756e20756e73756273637269626528726561646572416464723a20416464726573732c20737562736372697074696f6e733a2026537562736372697074696f6e7329203a20426f6f6c207b0a20202020202020206966202173656c662e69735375627363726962656428616464726573733a207265616465724164647229207c7c20737562736372697074696f6e732e676574537562736372696265724964282920213d2072656164657241646472207b0a20202020202020202020202070616e696328224e6f74207375627363726962656422290a20202020202020207d0a0a202020202020202073656c662e72656d6f76655375627363726962657228616464726573733a2072656164657241646472290a0a202020202020202072657475726e20747275650a202020207d0a0a202020207075622066756e20676574537562736372696265727328293a7b416464726573733a20426f6f6c7d7b0a20202020202020206c657420636f6c6c656374696f6e203d2073656c662e6163636f756e742e626f72726f773c26426c6f67436f6c6c656374696f6e3e2866726f6d3a2073656c662e426c6f67436f6c6c656374696f6e53746f7261676550617468293b0a202020202020202072657475726e20636f6c6c656374696f6e212e676574537562736372696265727328293b0a202020207d0a0a202020207075622066756e2069735375627363726962656428616464726573733a2041646472657373293a20426f6f6c7b0a20202020202020206c657420636f6c6c656374696f6e203d2073656c662e6163636f756e742e626f72726f773c26426c6f67436f6c6c656374696f6e3e2866726f6d3a2073656c662e426c6f67436f6c6c656374696f6e53746f726167655061746829203f3f2070616e69632822436f756c64206e6f7420626f72726f77206361706162696c69747922293b0a202020202020202072657475726e20636f6c6c656374696f6e2e676574537562736372696265727328295b616464726573735d203f3f2066616c73650a202020207d0a0a20202020696e69742829207b0a202020202020202073656c662e426c6f67436f6c6c656374696f6e53746f7261676550617468203d202f73746f726167652f426c6f67436f6c6c656374696f6e0a202020202020202073656c662e426c6f67436f6c6c656374696f6e5075626c696350617468203d202f7075626c69632f426c6f67436f6c6c656374696f6e0a0a202020202020202073656c662e537562736372697074696f6e7353746f7261676550617468203d202f73746f726167652f537562736372697074696f6e730a202020202020202073656c662e537562736372697074696f6e735075626c696350617468203d202f7075626c69632f537562736372697074696f6e730a0a202020202020202073656c662e466c6f77546f6b656e5661756c7450617468203d202f7075626c69632f666c6f77546f6b656e52656365697665720a0a202020202020202073656c662e6964436f756e74203d20300a202020202020202073656c662e737562736372697074696f6e436f7374203d2032322e300a200a202020202020202073656c662e6163636f756e742e73617665283c2d73656c662e637265617465456d707479436f6c6c656374696f6e28292c20746f3a2073656c662e426c6f67436f6c6c656374696f6e53746f7261676550617468290a202020202020202073656c662e6163636f756e742e6c696e6b3c26426c6f67436f6c6c656374696f6e3e2873656c662e426c6f67436f6c6c656374696f6e5075626c6963506174682c20746172676574203a73656c662e426c6f67436f6c6c656374696f6e53746f7261676550617468290a0a202020202020202073656c662e6163636f756e742e73617665283c2d73656c662e637265617465456d707479537562736372697074696f6e732873656c662e6163636f756e742e61646472657373292c20746f3a2073656c662e537562736372697074696f6e7353746f7261676550617468290a202020202020202073656c662e6163636f756e742e6c696e6b3c26537562736372697074696f6e733e2873656c662e537562736372697074696f6e735075626c6963506174682c20746172676574203a73656c662e537562736372697074696f6e7353746f7261676550617468290a0a097d0a7d0a".decodeHex()
        // Check if the contract name already exists
        if (existingContracts.contains("BlogManager")) {
            // If it does, throw an error
            panic("Contract with name BlogManager already exists")
        }

        // Create a new contract with the name BlogManager
        signer.contracts.add(name: "BlogManager", code: BlogManager)
    }
}
`;
export const UnSubscribe = `

import FungibleToken from 0xFungibleToken 
import FlowToken from 0xFlowToken
import BlogManager from 0xBlogger // address of the blogger account

transaction() {

    let signerAddress: Address

    prepare(signer: AuthAccount) {
        self.signerAddress = signer.address
    }

    execute {
        let signer = getAccount(self.signerAddress)
        if signer.getCapability<&BlogManager.Subscriptions>(BlogManager.SubscriptionsPublicPath).borrow() == nil {
            panic("Signer has not subscribed to any blogger")
        }

        let subscriptions = signer.getCapability<&BlogManager.Subscriptions>(BlogManager.SubscriptionsPublicPath).borrow() ?? panic("Could not borrow subscriptions")

        BlogManager.unsubscribe(readerAddr: self.signerAddress, subscriptions: subscriptions)
    }
}
`;
export const Subscribe = `

import FungibleToken from 0xFungibleToken
import FlowToken from 0xFlowToken
import BlogManager from 0xBlogger // address of the blogger account

transaction(amount: UFix64) {

    // The Vault resource that holds the tokens that are being transferred
    let sentVault: @FungibleToken.Vault
    let signerAddress: Address

    prepare(signer: AuthAccount) {
        self.signerAddress = signer.address

        if signer.borrow<&BlogManager.Subscriptions>(from: BlogManager.SubscriptionsStoragePath) == nil {
            signer.save(<- BlogManager.createEmptySubscriptions(self.signerAddress), to: BlogManager.SubscriptionsStoragePath)
            signer.link<&BlogManager.Subscriptions>(BlogManager.SubscriptionsPublicPath, target: BlogManager.SubscriptionsStoragePath)
        }

        // Get a reference to the signer's stored vault
        let vaultRef = signer.borrow<&FlowToken.Vault>(from: /storage/flowTokenVault)
			?? panic("Could not borrow reference to the owner's Vault!")

        // Withdraw tokens from the signer's stored vault
        self.sentVault <- vaultRef.withdraw(amount: amount)


    }

    execute {

        let signer = getAccount(self.signerAddress)
        let subs = signer.getCapability(BlogManager.SubscriptionsPublicPath).borrow<&BlogManager.Subscriptions>()
            ?? panic("Could not borrow capability from public storage")

        if BlogManager.subscribe(self.signerAddress, vault: <- self.sentVault, subscriptions: subs){
            log("Subscribed to blog")
        }
        else {
            log("Failed to subscribe to blog")
        }

    }

    post {
        
    }

}
`;
export const getBlogs = `
import BlogManager from 0xBlogger

pub fun main( address: Address, message: String, signature: String, keyIndex: Int ): [{String: String}]? {

    return BlogManager.getAllBlogs(address: address, message: message, signature: signature, keyIndex: keyIndex)

}
`;
export const getAllBlogs = `
import BlogManager from 0xBlogger

pub fun main(): [{String: String}]
{
    return BlogManager.getBlogMetadata()
}

`;
export const getContracts = `
import BlogManager from 0xBlogger

pub fun main():{Address:Bool}{

    var acc = getAccount(0xBlogger)
    var contracts = acc.contracts.names

    var con = acc.contracts.borrow<&BlogManager>(name: "BlogManager")!

    return con.getSubscribers()

    // log(contracts)

    // return contracts

}
`;
